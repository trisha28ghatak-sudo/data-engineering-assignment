# scripts/create_dim_date.py

import pandas as pd
import os

OUT_CSV = "data/processed/csv/dim_date.csv"
OUT_PARQUET = "data/processed/parquet/dim_date.parquet"

# Create output folders if missing
os.makedirs("data/processed/csv", exist_ok=True)
os.makedirs("data/processed/parquet", exist_ok=True)

def create_dim_date(start_date="2020-01-01", end_date="2030-12-31"):
    # Create date range
    date_range = pd.date_range(start=start_date, end=end_date)

    # Build DataFrame
    df = pd.DataFrame({
        "date": date_range,
        "date_key": date_range.strftime("%Y%m%d").astype(int),
        "year": date_range.year,
        "month": date_range.month,
        "month_name": date_range.strftime("%B"),
        "day": date_range.day,
        "day_of_week": date_range.day_name(),
        "week": date_range.isocalendar().week,
        "quarter": date_range.quarter
    })

    return df


def main():
    print("Creating dim_date...")

    df = create_dim_date()

    # Save CSV
    df.to_csv(OUT_CSV, index=False)
    print(f"dim_date CSV saved to: {OUT_CSV}")

    # Save Parquet
    try:
        df.to_parquet(OUT_PARQUET, index=False)
        print(f"dim_date Parquet saved to: {OUT_PARQUET}")
    except Exception:
        print("Parquet writing failed. Install pyarrow: pip install pyarrow")

    print("dim_date creation complete.")


if __name__ == "__main__":
    main()

